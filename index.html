<!DOCTYPE html>
<html lang="en">

	<head>
	    <meta charset="utf-8" />
	    <title>Mk2</title>

		<link rel='stylesheet' type='text/css' href='frameworks/brick-0.9.1.css'>
		<link rel="stylesheet" type="text/css" href="main.css"/>
		<link href='http://fonts.googleapis.com/css?family=Raleway' rel='stylesheet' type='text/css'>

	    <script type='text/javascript' src='frameworks/brick-0.9.1.js'></script> 
	    <script type='text/javascript' src='frameworks/paper.js'></script> 

		<script type='text/javascript' src='main.js'></script> 	    
		<script type='text/javascript' src='HPGe.js'></script> 

	</head>

	<body>

		<div id='wrapper'>

		    <div id='branding'>
		    	<img id='logo' src='logo.gif'></img>
		    	<h1>GRIFFIN</h1>
		    </div>

		    <div id='navigation'>
		    	<button id='statusButton' class='navButton'>MIDAS Status</button>
		    	<button id='dashboardButton' class='navButton'>Dashboard</button>
		    	<button id='HVButton' class='navButton'>HV Monitor</button>
		    	<button id='subsystemButton' class='navButton'>Subsystem Monitor</button>
		    	<button id='DAQButton' class='navButton'>DAQ</button>
		    	<button id='clockButton' class='navButton'>Clock</button>
		    	<button id='filterButton' class='navButton'>Filter</button>
		    	<button id='VMEButton' class='navButton'>VME</button>
		    	<button id='cycleButton' class='navButton'>Cycle</button>
		    </div>

		    <div id='statusBar'>

		    </div>

		    <div id='main'>
		    	<div id='canvasWrap'>
		    		<x-deck id='subNavigation'>
				    	<x-card>
				    		<h2 class='subNavHeader'>Dashboard</h2>
				    	</x-card>
				    	<x-card>
				    		<h2 class='subNavHeader'>HV Monitor</h2>
				    	</x-card>
				    	<x-card id='subsystemNavCard'>
				    		<h2 class='subNavHeader'>Subsystem Monitor</h2>
				    	</x-card>				    	
				    	<x-card>
				    		<h2 class='subNavHeader'>DAQ</h2>
				    	</x-card>
				    	<x-card>
				    		<h2 class='subNavHeader'>Clock</h2>
				    	</x-card>
				    	<x-card>
				    		<h2 class='subNavHeader'>Filter</h2>
				    	</x-card>
				    	<x-card>
				    		<h2 class='subNavHeader'>VME</h2>
				    	</x-card>
				    	<x-card>
				    		<h2 class='subNavHeader'>Cycle</h2>
				    	</x-card>
		    		</x-deck>

		    		<x-deck id='visualization'>
			    		<x-card><canvas id='mainCanvas'></canvas></x-card>
			    	</x-deck>
		    	</div>

		    	<x-deck id='sidebar' transition-type='scrollUp'>
			    	<x-card>Dashboard side</x-card>
			    	<x-card id='HVsidebar'></x-card>
			    	<x-card>HPGe side</x-card>				    	
			    	<x-card>DAQ side</x-card>
			    	<x-card>Clock side</x-card>
			    	<x-card>Filter side</x-card>
			    	<x-card>VME side</x-card>
			    	<x-card>Cycle side</x-card>
			    </x-deck>
		    </div>

			<div id='tooltip'></div>
		</div>

		<div id='footer'>
			GRIFFIN Mark II Monitoring & Control
		</div>

		<script type='text/paperscript', canvas='mainCanvas'>
				//globals
				layer = {};
				path = {};

				//deploy stuff
				renderDashboard();
				renderHV();
				renderHPGe();
				renderDAQ();
				renderClock();
				renderFilter();
				renderVME();
				renderCycle();

				renderDESCANT();
				renderSPICE();

				//tooltip
				function onMouseMove(event) {
					project.activeLayer.selected = false;
					if (event.item){
						event.item.selected = true;
						document.getElementById('tooltip').innerHTML = event['_item'].channel;
						summonTooltip(event.event.clientX, event.event.clientY);
					} else
						dismissTooltip();
				}	

				//animation
				function onFrame(event){
					var x0, y0;
					
					for(key in path){
						//color transitions
						if(path[key].layer.visible && dataBus[key] && 
							(	dataBus[key].currentColor[0] != dataBus[key].color[0] || 
								dataBus[key].currentColor[1] != dataBus[key].color[1] || 
								dataBus[key].currentColor[2] != dataBus[key].color[2]) 
							){
							incrementColor(key);
							path[key].fillColor.red = dataBus[key].currentColor[0]/255;
							path[key].fillColor.blue = dataBus[key].currentColor[1]/255;
							path[key].fillColor.green = dataBus[key].currentColor[2]/255;
						}

						//width transition (horizontal bar graphs)
						if(path[key].layer.visible && dataBus[key] && dataBus[key].width && dataBus[key].currentWidth != dataBus[key].width){
							incrementWidth(key);
							//bottom left corner of box - fixed point on both horizontal and vertical bars.
							x0 = path[key]['_segments'][3]['_point']['_x'];
							//y0 = path[key]['_segments'][3]['_point']['_y'];
							path[key]['_segments'][1]['_point']['_x'] = x0 + dataBus[key].currentWidth;
							path[key]['_segments'][2]['_point']['_x'] = x0 + dataBus[key].currentWidth;
						}

						//height transition (horizontal bar graphs)
						if(path[key].layer.visible && dataBus[key] && dataBus[key].height && dataBus[key].currentHeight != dataBus[key].height){
							incrementHeight(key);
							//bottom left corner of box - fixed point on both horizontal and vertical bars.
							y0 = path[key]['_segments'][3]['_point']['_y'];
							path[key]['_segments'][0]['_point']['_y'] = y0 - dataBus[key].currentHeight;
							path[key]['_segments'][1]['_point']['_y'] = y0 - dataBus[key].currentHeight;
						}
					}
					
				}

		</script>

		<script>
			document.addEventListener('DOMComponentsLoaded', function(){

				var statusButton = document.getElementById('statusButton'),
					dashboardButton = document.getElementById('dashboardButton'),
					HVButton = document.getElementById('HVButton'),
					subsystemButton = document.getElementById('subsystemButton'),
					DAQButton = document.getElementById('DAQButton'),
					clockButton = document.getElementById('clockButton'),
					filterButton = document.getElementById('filterButton'),
					VMEButton = document.getElementById('VMEButton'),
					cycleButton = document.getElementById('cycleButton');

			 	sidebar = document.getElementById('sidebar');
				subNav = document.getElementById('subNavigation');
				visualization = document.getElementById('visualization');

				//configure top level buttons
				dashboardButton.addEventListener('click', navigate.bind(null, 0, 0, 0, 'dashboard'));
				HVButton.addEventListener('click', navigate.bind(null, 1, 1, 0, 'HV'));
				subsystemButton.addEventListener('click', navigate.bind(null, 2, 2, 0, 'HPGe'));
				DAQButton.addEventListener('click', navigate.bind(null, 3, 3, 0, 'DAQ'));
				clockButton.addEventListener('click', navigate.bind(null, 4, 4, 0, 'clock'));
				filterButton.addEventListener('click', navigate.bind(null, 5, 5, 0, 'filter'));
				VMEButton.addEventListener('click', navigate.bind(null, 6, 6, 0, 'VME'));
				cycleButton.addEventListener('click', navigate.bind(null, 7, 7, 0, 'cycle'));		

			});


			//dummy dataBus
			dataBus = {};
			dataBus.GRG06BN00A = {}
			dataBus.GRG06BN00A.oldColor = [255,255,255]
			dataBus.GRG06BN00A.currentColor = [255,255,255]
			dataBus.GRG06BN00A.color = [255,0,0]
			dataBus.DSC01XN00X = {}
			dataBus.DSC01XN00X.oldColor = [255,255,255]
			dataBus.DSC01XN00X.currentColor = [255,255,255]
			dataBus.DSC01XN00X.color = [0,255,0]
			dataBus.DAL01XN00X = {}
			dataBus.DAL01XN00X.oldColor = [255,255,255]
			dataBus.DAL01XN00X.currentColor = [255,255,255]
			dataBus.DAL01XN00X.color = [0,0,255]
			dataBus.DAL01XN00X.oldHeight = 50
			dataBus.DAL01XN00X.currentHeight = 50
			dataBus.DAL01XN00X.height = 300


		</script>

	</body>

</html>